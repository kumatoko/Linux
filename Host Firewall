Host Firewall



Using UFW (Uncomplicated Firewall)

Start by installing ufw

sudo apt install ufw


Bu default, ufw should rely all incoming connections and allow all outgoing connections. To check this you must first enable ufw with

sudo ufw enable


Then run

sudo ufw status verbose


You should see
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)

Just incase you don’t see that, or want to make double sure these are set, you can run

sudo ufw default deny incoming && sudo ufw default allow outgoing


From here, you can set  your specific rules.
For example, when I setup ufw on my PiHole I had to open up a few ports for it to function properly. 

I started with 

sudo ufw allow 22/tcp


Before moving forward, I needed to make sure I didn’t break my SSH connection ability.
Open up a new terminal window and see if you can connect through SSH. If you can connect, you’re golden.
If you cannot connect, make sure you don’t disconnect from your current session, You’ll need to sort out the issue while still connected.

Moving on, I opened up ports 53 for DNS, port 5335 for unbound, and port 123 for NTP. 

sudo ufw allow 53
sudo ufw allow 5335
sudo ufw allow 123


From here, I tested everything to make sure the PiHole was still working. Everything was fine except I was unable to connect to the PiHole GUI. I realized I forgot to open up ports 80 and 443. I fixed that with 

sudo ufw allow 80/tcp
sudo ufw allow 443/tcp


A note on allowing specific ports vs allowing services.
You can also use commands to allow OpenSSH and allow HTTP

sudo ufw allow openssh
sudo ufw allow http

However, you might want to go with specific ports, especially if you have reassigned different ports to common services.
For example, I have my PiHole SSH setup to run through port 717 instead of port 22. 

When you’ve completed the initial setup, be sure to backup your settings with

sudo ufw status numbered > ufw-backup.txt


There are many more commands you can get into, but this should get you started. 
Example: Only allow SSH from a specific IP, or a specific subnet.

sudo ufw allow from 192.168.1.12 proto tcp to any port 22
sudo ufw allow from 192.168.1.0/24 proto tcp to any port 22
